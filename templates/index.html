<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureWatch Pro - Security Monitoring System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-bar {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-online { background: #2ecc71; }
        .status-offline { background: #e74c3c; }
        .status-warning { background: #f39c12; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .video-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .video-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .video-controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-feed {
            max-width: 100%;
            max-height: 100%;
            border-radius: 15px;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .detection-box {
            position: absolute;
            border: 3px solid;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.1);
            pointer-events: none;
        }

        .detection-box.person { border-color: #e74c3c; }
        .detection-box.face { border-color: #3498db; }
        .detection-box.car { border-color: #f39c12; }

        .detection-label {
            position: absolute;
            top: -25px;
            left: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }

        .no-video {
            text-align: center;
            color: #7f8c8d;
            font-size: 18px;
        }

        .alerts-panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            max-height: 600px;
            overflow-y: auto;
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .alert-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .alert-item:hover {
            transform: translateX(5px);
            background: rgba(0, 0, 0, 0.5);
        }

        .alert-high { border-left-color: #e74c3c; }
        .alert-medium { border-left-color: #f39c12; }
        .alert-low { border-left-color: #3498db; }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-title {
            font-weight: 600;
            font-size: 14px;
        }

        .alert-time {
            font-size: 12px;
            opacity: 0.7;
        }

        .alert-message {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .alert-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 5px 12px;
            font-size: 12px;
            border-radius: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.7;
        }

        .settings-panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .setting-group {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .setting-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .setting-label {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .setting-description {
            font-size: 12px;
            opacity: 0.7;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #2ecc71;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }

        .range-input {
            width: 100px;
            height: 5px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #2ecc71;
            cursor: pointer;
        }

        .select-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
            padding: 5px 10px;
            min-width: 100px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            border-left: 4px solid;
            max-width: 300px;
            transform: translateX(400px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { border-left-color: #2ecc71; }
        .notification.error { border-left-color: #e74c3c; }
        .notification.warning { border-left-color: #f39c12; }
        .notification.info { border-left-color: #3498db; }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .footer {
            text-align: center;
            padding: 20px;
            opacity: 0.7;
            font-size: 14px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">🛡️</div>
                <div>
                    <h1>SecureWatch Pro</h1>
                    <p style="opacity: 0.7; font-size: 14px;">Advanced Security Monitoring</p>
                </div>
            </div>
            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot status-offline" id="systemStatus"></div>
                    <span id="systemStatusText">System Offline</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot status-offline" id="cameraStatus"></div>
                    <span id="cameraStatusText">Camera Offline</span>
                </div>
                <div class="status-indicator">
                    <span id="alertCount">0 Alerts</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-grid">
            <!-- Video Section -->
            <div class="video-section">
                <div class="video-header">
                    <h2>Live Camera Feed</h2>
                    <div class="video-controls">
                        <button class="btn btn-primary" id="startCamera">
                            <span>▶️</span> Start Camera
                        </button>
                        <button class="btn btn-danger" id="stopCamera">
                            <span>⏹️</span> Stop Camera
                        </button>
                        <button class="btn btn-secondary" id="settingsBtn">
                            <span>⚙️</span> Settings
                        </button>
                    </div>
                </div>
                <div class="video-container">
                    <div class="no-video" id="noVideo">
                        <h3>📹 Camera Feed Inactive</h3>
                        <p>Click "Start Camera" to begin monitoring</p>
                    </div>
                    <img id="videoFeed" class="video-feed" style="display: none;" />
                    <div class="video-overlay" id="videoOverlay"></div>
                </div>
            </div>

            <!-- Alerts Panel -->
            <div class="alerts-panel">
                <div class="alerts-header">
                    <h2>Security Alerts</h2>
                    <button class="btn btn-secondary btn-small" id="clearAlertsBtn">Clear All</button>
                </div>
                <div id="alertsList">
                    <div style="text-align: center; opacity: 0.7; padding: 20px;">
                        <p>No alerts at this time</p>
                        <p style="font-size: 12px; margin-top: 10px;">System is monitoring for security events</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon" style="background: linear-gradient(45deg, #3498db, #2980b9);">📊</div>
                    <div class="stat-value" id="systemUptime">99.9%</div>
                </div>
                <div class="stat-label">System Uptime</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">🚨</div>
                    <div class="stat-value" id="totalAlerts">0</div>
                </div>
                <div class="stat-label">Total Alerts Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon" style="background: linear-gradient(45deg, #2ecc71, #27ae60);">📹</div>
                    <div class="stat-value" id="activeStreams">0</div>
                </div>
                <div class="stat-label">Active Streams</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon" style="background: linear-gradient(45deg, #f39c12, #e67e22);">💾</div>
                    <div class="stat-value" id="storageUsed">45%</div>
                </div>
                <div class="stat-label">Storage Used</div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel" style="display: none;">
            <h2 style="margin-bottom: 20px;">System Settings</h2>
            <div class="settings-grid">
                <div class="setting-group">
                    <h3 style="margin-bottom: 15px; color: #3498db;">Detection Settings</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Face Blurring</div>
                            <div class="setting-description">Automatically blur detected faces for privacy</div>
                        </div>
                        <div class="toggle-switch" id="faceBlurringToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Privacy Mode</div>
                            <div class="setting-description">Enhanced privacy protection</div>
                        </div>
                        <div class="toggle-switch" id="privacyModeToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Detection Confidence</div>
                            <div class="setting-description">Minimum confidence for object detection</div>
                        </div>
                        <input type="range" class="range-input" id="confidenceSlider" min="0.1" max="1.0" step="0.1" value="0.5">
                        <span id="confidenceValue">0.5</span>
                    </div>
                </div>
                <div class="setting-group">
                    <h3 style="margin-bottom: 15px; color: #e74c3c;">Alert Settings</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Notifications</div>
                            <div class="setting-description">Enable push notifications</div>
                        </div>
                        <div class="toggle-switch active" id="notificationsToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Alert Sensitivity</div>
                            <div class="setting-description">How sensitive the system is to threats</div>
                        </div>
                        <select class="select-input" id="sensitivitySelect">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Motion Threshold</div>
                            <div class="setting-description">Sensitivity for motion detection</div>
                        </div>
                        <input type="range" class="range-input" id="motionSlider" min="0" max="100" step="10" value="50">
                        <span id="motionValue">50</span>
                    </div>
                </div>
                <div class="setting-group">
                    <h3 style="margin-bottom: 15px; color: #f39c12;">Video Settings</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Video Quality</div>
                            <div class="setting-description">Streaming quality setting</div>
                        </div>
                        <select class="select-input" id="qualitySelect">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-primary" id="saveSettingsBtn">💾 Save Settings</button>
                <button class="btn btn-secondary" id="cancelSettingsBtn">❌ Cancel</button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 SecureWatch Pro. Advanced Security Monitoring System.</p>
        </footer>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Quick Settings</h3>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Access the full settings panel below to configure all system options.</p>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" id="showFullSettings">Open Full Settings</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SecurityMonitoringSystem {
            constructor() {
                this.socket = null;
                this.isConnected = false;
                this.cameraRunning = false;
                this.alerts = [];
                this.settings = {
                    privacy_mode: false,
                    alert_sensitivity: 'medium',
                    face_blurring: true,
                    motion_threshold: 50,
                    notification_enabled: true,
                    yolo_confidence: 0.5,
                    video_quality: 'medium'
                };
                this.stats = {
                    uptime: '99.9%',
                    totalAlerts: 0,
                    activeStreams: 0,
                    storageUsed: 45
                };
                
                this.init();
            }

            init() {
                this.setupSocketConnection();
                this.setupEventListeners();
                this.loadSettings();
                this.updateUI();
                this.startHeartbeat();
            }

            setupSocketConnection() {
                try {
                    this.socket = io('http://localhost:5000');
                    
                    this.socket.on('connect', () => {
                        this.isConnected = true;
                        this.updateSystemStatus('online');
                        this.showNotification('Connected to monitoring system', 'success');
                    });

                    this.socket.on('disconnect', () => {
                        this.isConnected = false;
                        this.updateSystemStatus('offline');
                        this.showNotification('Disconnected from monitoring system', 'error');
                    });

                    this.socket.on('video_frame', (data) => {
                        this.updateVideoFeed(data);
                    });

                    this.socket.on('new_alert', (alert) => {
                        this.addAlert(alert);
                        this.showNotification(`New ${alert.type.replace('_', ' ')}: ${alert.message}`, 'warning');
                    });

                    this.socket.on('error', (data) => {
                        this.showNotification(data.message, 'error');
                    });

                    this.socket.on('heartbeat', (data) => {
                        // Keep connection alive
                    });

                } catch (error) {
                    console.error('Socket connection failed:', error);
                    this.simulateOfflineMode();
                }
            }

            simulateOfflineMode() {
                // Demo mode when backend is not available
                this.showNotification('Running in demo mode - backend not connected', 'info');
                this.simulateData();
            }

            simulateData() {
                // Simulate some demo alerts
                setTimeout(() => {
                    this.addAlert({
                        id: 'demo1',
                        type: 'person_detected',
                        severity: 'medium',
                        message: 'Person detected in camera view',
                        timestamp: new Date().toISOString(),
                        acknowledged: false,
                        camera_name: 'Demo Camera'
                    });
                }, 2000);

                setTimeout(() => {
                    this.addAlert({
                        id: 'demo2',
                        type: 'face_detected',
                        severity: 'low',
                        message: 'Face detected and blurred for privacy',
                        timestamp: new Date().toISOString(),
                        acknowledged: false,
                        camera_name: 'Demo Camera'
                    });
                }, 5000);

                // Simulate stats updates
                setInterval(() => {
                    this.stats.storageUsed = Math.min(95, this.stats.storageUsed + Math.random() * 2);
                    this.updateStats();
                }, 10000);
            }

            setupEventListeners() {
                // Camera controls
                document.getElementById('startCamera').addEventListener('click', () => {
                    this.startCamera();
                });

                document.getElementById('stopCamera').addEventListener('click', () => {
                    this.stopCamera();
                });

                // Settings
                document.getElementById('settingsBtn').addEventListener('click', () => {
                    document.getElementById('settingsModal').classList.add('show');
                });

                document.getElementById('closeModal').addEventListener('click', () => {
                    document.getElementById('settingsModal').classList.remove('show');
                });

                document.getElementById('showFullSettings').addEventListener('click', () => {
                    document.getElementById('settingsModal').classList.remove('show');
                    document.getElementById('settingsPanel').style.display = 'block';
                    document.getElementById('settingsPanel').scrollIntoView({ behavior: 'smooth' });
                });

                // Settings controls
                document.getElementById('saveSettingsBtn').addEventListener('click', () => {
                    this.saveSettings();
                });

                document.getElementById('cancelSettingsBtn').addEventListener('click', () => {
                    document.getElementById('settingsPanel').style.display = 'none';
                    this.loadSettings(); // Reset to original values
                });

                // Toggle switches
                this.setupToggle('faceBlurringToggle', 'face_blurring');
                this.setupToggle('privacyModeToggle', 'privacy_mode');
                this.setupToggle('notificationsToggle', 'notification_enabled');

                // Range sliders
                this.setupSlider('confidenceSlider', 'confidenceValue', 'yolo_confidence');
                this.setupSlider('motionSlider', 'motionValue', 'motion_threshold');

                // Select dropdowns
                this.setupSelect('sensitivitySelect', 'alert_sensitivity');
                this.setupSelect('qualitySelect', 'video_quality');

                // Alert controls
                document.getElementById('clearAlertsBtn').addEventListener('click', () => {
                    this.clearAllAlerts();
                });

                // Click outside modal to close
                document.getElementById('settingsModal').addEventListener('click', (e) => {
                    if (e.target.id === 'settingsModal') {
                        document.getElementById('settingsModal').classList.remove('show');
                    }
                });
            }

            setupToggle(toggleId, settingKey) {
                const toggle = document.getElementById(toggleId);
                toggle.addEventListener('click', () => {
                    toggle.classList.toggle('active');
                    this.settings[settingKey] = toggle.classList.contains('active');
                });
            }

            setupSlider(sliderId, valueId, settingKey) {
                const slider = document.getElementById(sliderId);
                const valueDisplay = document.getElementById(valueId);
                
                slider.addEventListener('input', () => {
                    const value = settingKey === 'yolo_confidence' ? parseFloat(slider.value) : parseInt(slider.value);
                    this.settings[settingKey] = value;
                    valueDisplay.textContent = value;
                });
            }

            setupSelect(selectId, settingKey) {
                const select = document.getElementById(selectId);
                select.addEventListener('change', () => {
                    this.settings[settingKey] = select.value;
                });
            }

            async startCamera() {
                try {
                    const startBtn = document.getElementById('startCamera');
                    startBtn.innerHTML = '<div class="loading"></div> Starting...';
                    startBtn.disabled = true;

                    if (this.socket && this.isConnected) {
                        const response = await fetch('/api/camera/start', { method: 'POST' });
                        const result = await response.json();
                        
                        if (result.success) {
                            this.cameraRunning = true;
                            this.updateCameraStatus('online');
                            this.showNotification('Camera started successfully', 'success');
                            document.getElementById('noVideo').style.display = 'none';
                            document.getElementById('videoFeed').style.display = 'block';
                        } else {
                            this.showNotification(result.message, 'error');
                        }
                    } else {
                        // Demo mode
                        this.cameraRunning = true;
                        this.updateCameraStatus('online');
                        this.showNotification('Camera started (Demo Mode)', 'success');
                        this.simulateVideoFeed();
                    }
                } catch (error) {
                    this.showNotification('Failed to start camera', 'error');
                } finally {
                    const startBtn = document.getElementById('startCamera');
                    startBtn.innerHTML = '<span>▶️</span> Start Camera';
                    startBtn.disabled = false;
                }
            }

            async stopCamera() {
                try {
                    const stopBtn = document.getElementById('stopCamera');
                    stopBtn.innerHTML = '<div class="loading"></div> Stopping...';
                    stopBtn.disabled = true;

                    if (this.socket && this.isConnected) {
                        const response = await fetch('/api/camera/stop', { method: 'POST' });
                        const result = await response.json();
                        
                        if (result.success) {
                            this.cameraRunning = false;
                            this.updateCameraStatus('offline');
                            this.showNotification('Camera stopped', 'info');
                            document.getElementById('videoFeed').style.display = 'none';
                            document.getElementById('noVideo').style.display = 'block';
                            document.getElementById('videoOverlay').innerHTML = '';
                        } else {
                            this.showNotification(result.message, 'error');
                        }
                    } else {
                        // Demo mode
                        this.cameraRunning = false;
                        this.updateCameraStatus('offline');
                        this.showNotification('Camera stopped', 'info');
                        document.getElementById('videoFeed').style.display = 'none';
                        document.getElementById('noVideo').style.display = 'block';
                        document.getElementById('videoOverlay').innerHTML = '';
                    }
                } catch (error) {
                    this.showNotification('Failed to stop camera', 'error');
                } finally {
                    const stopBtn = document.getElementById('stopCamera');
                    stopBtn.innerHTML = '<span>⏹️</span> Stop Camera';
                    stopBtn.disabled = false;
                }
            }

            simulateVideoFeed() {
                // Create a demo canvas for video feed simulation
                const canvas = document.createElement('canvas');
                canvas.width = 640;
                canvas.height = 480;
                const ctx = canvas.getContext('2d');
                
                const animate = () => {
                    if (!this.cameraRunning) return;
                    
                    // Create gradient background
                    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                    gradient.addColorStop(0, '#1e3c72');
                    gradient.addColorStop(1, '#2a5298');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Add some moving elements
                    const time = Date.now() * 0.001;
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                    for (let i = 0; i < 5; i++) {
                        const x = (Math.sin(time + i) * 100) + canvas.width / 2;
                        const y = (Math.cos(time + i * 0.7) * 50) + canvas.height / 2;
                        ctx.beginPath();
                        ctx.arc(x, y, 20, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    // Add demo text
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.font = '24px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('DEMO CAMERA FEED', canvas.width / 2, canvas.height / 2);
                    ctx.font = '16px Arial';
                    ctx.fillText('Live Security Monitoring', canvas.width / 2, canvas.height / 2 + 30);
                    
                    // Convert to base64 and update video feed
                    const dataURL = canvas.toDataURL('image/jpeg', 0.8);
                    const base64Data = dataURL.split(',')[1];
                    
                    this.updateVideoFeed({
                        image: base64Data,
                        detections: [
                            {
                                bbox: [100, 100, 200, 200],
                                label: 'person',
                                confidence: 0.85
                            },
                            {
                                bbox: [300, 150, 380, 220],
                                label: 'face',
                                confidence: 0.92
                            }
                        ],
                        width: canvas.width,
                        height: canvas.height
                    });
                    
                    setTimeout(() => requestAnimationFrame(animate), 100);
                };
                
                animate();
            }

            updateVideoFeed(data) {
                const videoFeed = document.getElementById('videoFeed');
                const overlay = document.getElementById('videoOverlay');
                
                videoFeed.src = 'data:image/jpeg;base64,' + data.image;
                
                // Clear previous detections
                overlay.innerHTML = '';
                
                // Add detection boxes
                data.detections.forEach(detection => {
                    const box = document.createElement('div');
                    box.className = `detection-box ${detection.label}`;
                    
                    const [x1, y1, x2, y2] = detection.bbox;
                    const width = x2 - x1;
                    const height = y2 - y1;
                    
                    // Calculate relative positions
                    const containerRect = videoFeed.getBoundingClientRect();
                    const scaleX = containerRect.width / data.width;
                    const scaleY = containerRect.height / data.height;
                    
                    box.style.left = (x1 * scaleX) + 'px';
                    box.style.top = (y1 * scaleY) + 'px';
                    box.style.width = (width * scaleX) + 'px';
                    box.style.height = (height * scaleY) + 'px';
                    
                    const label = document.createElement('div');
                    label.className = 'detection-label';
                    label.textContent = `${detection.label} (${(detection.confidence * 100).toFixed(1)}%)`;
                    box.appendChild(label);
                    
                    overlay.appendChild(box);
                });
            }

            addAlert(alert) {
                this.alerts.unshift(alert);
                this.stats.totalAlerts++;
                this.updateAlertsUI();
                this.updateStats();
                
                // Auto-acknowledge demo alerts after 30 seconds
                if (alert.id.startsWith('demo')) {
                    setTimeout(() => {
                        this.acknowledgeAlert(alert.id);
                    }, 30000);
                }
            }

            updateAlertsUI() {
                const alertsList = document.getElementById('alertsList');
                const alertCount = document.getElementById('alertCount');
                
                alertCount.textContent = `${this.alerts.filter(a => !a.acknowledged).length} Alerts`;
                
                if (this.alerts.length === 0) {
                    alertsList.innerHTML = `
                        <div style="text-align: center; opacity: 0.7; padding: 20px;">
                            <p>No alerts at this time</p>
                            <p style="font-size: 12px; margin-top: 10px;">System is monitoring for security events</p>
                        </div>
                    `;
                    return;
                }
                
                alertsList.innerHTML = this.alerts.slice(0, 10).map(alert => {
                    const time = new Date(alert.timestamp).toLocaleTimeString();
                    const acknowledged = alert.acknowledged ? ' (Acknowledged)' : '';
                    
                    return `
                        <div class="alert-item alert-${alert.severity}" data-alert-id="${alert.id}">
                            <div class="alert-header">
                                <div class="alert-title">${alert.type.replace('_', ' ').toUpperCase()}${acknowledged}</div>
                                <div class="alert-time">${time}</div>
                            </div>
                            <div class="alert-message">${alert.message}</div>
                            <div class="alert-actions">
                                ${!alert.acknowledged ? `
                                    <button class="btn btn-primary btn-small" onclick="securitySystem.acknowledgeAlert('${alert.id}')">
                                        ✓ Acknowledge
                                    </button>
                                ` : ''}
                                <button class="btn btn-secondary btn-small" onclick="securitySystem.dismissAlert('${alert.id}')">
                                    ✕ Dismiss
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            acknowledgeAlert(alertId) {
                const alert = this.alerts.find(a => a.id === alertId);
                if (alert) {
                    alert.acknowledged = true;
                    this.updateAlertsUI();
                    this.showNotification('Alert acknowledged', 'success');
                    
                    if (this.socket && this.isConnected) {
                        fetch(`/api/alerts/${alertId}/acknowledge`, { method: 'POST' });
                    }
                }
            }

            dismissAlert(alertId) {
                this.alerts = this.alerts.filter(a => a.id !== alertId);
                this.updateAlertsUI();
                this.showNotification('Alert dismissed', 'info');
            }

            clearAllAlerts() {
                this.alerts = [];
                this.updateAlertsUI();
                this.showNotification('All alerts cleared', 'info');
            }

            async loadSettings() {
                try {
                    if (this.socket && this.isConnected) {
                        const response = await fetch('/api/settings');
                        this.settings = await response.json();
                    }
                    this.updateSettingsUI();
                } catch (error) {
                    console.error('Failed to load settings:', error);
                }
            }

            async saveSettings() {
                try {
                    const saveBtn = document.getElementById('saveSettingsBtn');
                    saveBtn.innerHTML = '<div class="loading"></div> Saving...';
                    saveBtn.disabled = true;

                    if (this.socket && this.isConnected) {
                        const response = await fetch('/api/settings', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.settings)
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            this.showNotification('Settings saved successfully', 'success');
                        } else {
                            this.showNotification(result.error || 'Failed to save settings', 'error');
                        }
                    } else {
                        this.showNotification('Settings saved (Demo Mode)', 'success');
                    }
                    
                    document.getElementById('settingsPanel').style.display = 'none';
                } catch (error) {
                    this.showNotification('Failed to save settings', 'error');
                } finally {
                    const saveBtn = document.getElementById('saveSettingsBtn');
                    saveBtn.innerHTML = '💾 Save Settings';
                    saveBtn.disabled = false;
                }
            }

            updateSettingsUI() {
                // Update toggles
                document.getElementById('faceBlurringToggle').classList.toggle('active', this.settings.face_blurring);
                document.getElementById('privacyModeToggle').classList.toggle('active', this.settings.privacy_mode);
                document.getElementById('notificationsToggle').classList.toggle('active', this.settings.notification_enabled);
                
                // Update sliders
                document.getElementById('confidenceSlider').value = this.settings.yolo_confidence;
                document.getElementById('confidenceValue').textContent = this.settings.yolo_confidence;
                document.getElementById('motionSlider').value = this.settings.motion_threshold;
                document.getElementById('motionValue').textContent = this.settings.motion_threshold;
                
                // Update selects
                document.getElementById('sensitivitySelect').value = this.settings.alert_sensitivity;
                document.getElementById('qualitySelect').value = this.settings.video_quality;
            }

            updateSystemStatus(status) {
                const statusDot = document.getElementById('systemStatus');
                const statusText = document.getElementById('systemStatusText');
                
                statusDot.className = `status-dot status-${status}`;
                statusText.textContent = `System ${status.charAt(0).toUpperCase() + status.slice(1)}`;
            }

            updateCameraStatus(status) {
                const statusDot = document.getElementById('cameraStatus');
                const statusText = document.getElementById('cameraStatusText');
                
                statusDot.className = `status-dot status-${status}`;
                statusText.textContent = `Camera ${status.charAt(0).toUpperCase() + status.slice(1)}`;
                
                this.stats.activeStreams = status === 'online' ? 1 : 0;
                this.updateStats();
            }

            updateStats() {
                document.getElementById('systemUptime').textContent = this.stats.uptime;
                document.getElementById('totalAlerts').textContent = this.stats.totalAlerts;
                document.getElementById('activeStreams').textContent = this.stats.activeStreams;
                document.getElementById('storageUsed').textContent = Math.round(this.stats.storageUsed) + '%';
            }

            updateUI() {
                this.updateAlertsUI();
                this.updateStats();
                this.updateSettingsUI();
            }

            showNotification(message, type = 'info') {
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 5px;">${type.toUpperCase()}</div>
                    <div>${message}</div>
                `;
                
                container.appendChild(notification);
                
                // Show notification
                setTimeout(() => notification.classList.add('show'), 100);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (container.contains(notification)) {
                            container.removeChild(notification);
                        }
                    }, 300);
                }, 5000);
            }

            startHeartbeat() {
                setInterval(() => {
                    if (this.socket && this.isConnected) {
                        this.socket.emit('heartbeat', { timestamp: Date.now() });
                    }
                }, 30000);
            }

            async fetchSystemStatus() {
                try {
                    if (!this.socket || !this.isConnected) return;
                    
                    const response = await fetch('/api/system/status');
                    const status = await response.json();
                    
                    this.stats.uptime = status.uptime;
                    this.stats.storageUsed = status.storage_used;
                    this.stats.activeStreams = status.active_streams;
                    
                    this.updateStats();
                } catch (error) {
                    console.error('Failed to fetch system status:', error);
                }
            }
        }

        // Initialize the security monitoring system
        const securitySystem = new SecurityMonitoringSystem();

        // Periodic status updates
        setInterval(() => {
            securitySystem.fetchSystemStatus();
        }, 10000);

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                console.log('Page hidden - reducing update frequency');
            } else {
                console.log('Page visible - resuming normal operation');
                securitySystem.updateUI();
            }
        });

        // Handle window resize for video overlay positioning
        window.addEventListener('resize', () => {
            // Recalculate detection box positions if video is active
            if (securitySystem.cameraRunning) {
                // Trigger overlay update
                const videoFeed = document.getElementById('videoFeed');
                if (videoFeed.src) {
                    // Re-emit last frame data to update overlay positions
                }
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        document.getElementById('settingsModal').classList.add('show');
                        break;
                    case 'c':
                        e.preventDefault();
                        if (securitySystem.cameraRunning) {
                            securitySystem.stopCamera();
                        } else {
                            securitySystem.startCamera();
                        }
                        break;
                }
            }
            
            // ESC to close modals
            if (e.key === 'Escape') {
                document.getElementById('settingsModal').classList.remove('show');
                document.getElementById('settingsPanel').style.display = 'none';
            }
        });

        console.log('SecureWatch Pro Security Monitoring System Initialized');
        console.log('Keyboard shortcuts: Ctrl+S (Settings), Ctrl+C (Camera Toggle), ESC (Close)');
    </script>
</body>
</html>